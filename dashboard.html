<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agent Dashboard</title>
  <style>
    body { background: #0d0d0d; color: #00ffcc; font-family: monospace; margin: 0; padding: 0; }
    header { background: #000; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;}
    .menu-toggle { background: #00ffcc; color: #000; border: none; padding: 8px 16px; margin-left: 10px; cursor: pointer; }
    #wallet { font-weight: bold; }
    .side-menu { position: fixed; top: 0; right: -360px; width: 360px; height: 100%; background: #000; border-left:2px solid #00ffcc; padding:20px; transition:right .3s ease; overflow-y:auto; z-index: 10; }
    .side-menu.open { right: 0; }
    .close-btn { float:right; background:none; border:none; color:#00ffcc; font-size:1.2rem; cursor:pointer; }
    .tabs { display:flex; margin-bottom:10px; }
    .tab { flex:1; text-align:center; padding:8px; background:#111; cursor:pointer; }
    .tab.active { background:#00ffcc; color:#000; }
    .section-box, .card { padding:20px; max-width:600px; margin:20px auto; background:rgba(0,255,204,0.05); border:1px solid #00ffcc; }
    .card { margin:10px; }
    button { background:#00ffcc; color:#000; border:none; padding:8px 16px; margin:6px; cursor:pointer; }
    button:hover { background:#00ccb3; }
    #statusOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); color:#00ffcc; display:none; align-items:center; justify-content:center; font-size:1.2rem; text-align:center; z-index:9999; }
    input { padding:6px; width:80%; margin:6px 0; }
  </style>
</head>
<body>
  <header>
    <h2>üïµÔ∏è Agent Dashboard</h2>
    <div>
      <span id="wallet">üí∞ ‚Ç¨0</span>
      <button class="menu-toggle" onclick="toggleMenu()">‚ò∞ Menu</button>
      <button class="menu-toggle" onclick="showStocks()">üìà Invest</button>
      <button class="menu-toggle" onclick="showMission()">üéØ Mission</button>
      <button class="menu-toggle" onclick="showRecruit()">üßë Recruit</button>
      <button class="menu-toggle" onclick="showShop()">üõí Shop</button>
    </div>
  </header>

  <!-- Missions & Recruits Panel -->
  <div id="menuPanel" class="side-menu">
    <button class="close-btn" onclick="toggleMenu()">√ó</button>
    <h3>‚úÖ Missions</h3><div id="missionsList"></div><hr>
    <h3>üßë Recruits</h3><div id="recruitsList"></div>
  </div>

  <!-- Shop Panel -->
  <div id="shopPanel" class="side-menu">
    <button class="close-btn" onclick="closeShop()">√ó</button>
    <div class="tabs">
      <div class="tab active" id="tab-Cars" onclick="selectTab('Cars')">Cars</div>
      <div class="tab" id="tab-Houses" onclick="selectTab('Houses')">Houses</div>
      <div class="tab" id="tab-Weapons" onclick="selectTab('Weapons')">Weapons</div>
    </div>
    <div id="shopContent"></div>
  </div>

  <!-- Main Content -->
  <div id="mainContent">
    <div id="missionBox" class="section-box"></div>
    <div id="recruitBox" class="section-box"></div>
    <div id="stockBox" class="section-box"></div>
  </div>

  <div id="statusOverlay"></div>

  <script>
    // üì¶ State & Persistence
    let wallet = 100000, missions = [], recruits = [], shopItems = { Cars: [], Houses: [], Weapons: [] };
    let currentMission = null, currentRecruit = null, currentStock = null, shopTab = "Cars", restockTimers = {};

    const missionTemplates=["Intercept enemy transmission","Surveil high-value target","Extract compromised agent","Infiltrate secure facility","Plant tracking device","Retrieve encrypted data","Neutralize rogue operative","Secure secret package"];
    const stockNames=["ACME Corp","Global Dynamics","Zenith Tech","Nova Energy","Quantum Systems","Helix Pharma"];
    const carNames=["Phantom","Eclipse","Falcon","Striker","Specter"];
    const houseNames=["Villa Grande","Oak Manor","Sky High","Lakeside Retreat","Hilltop Estate"];
    const weaponNames=["Nightshade","Reaper","Vanguard","Specter","Talion"];

    function random(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

    function loadState(){
      const d = JSON.parse(localStorage.getItem("agentDash")||"{}");
      if(d.wallet!=null) wallet=d.wallet;
      if(d.missions) missions=d.missions;
      if(d.recruits) recruits=d.recruits;
      if(d.shopItems) shopItems=d.shopItems;
    }

    function saveState(){
      localStorage.setItem("agentDash", JSON.stringify({ wallet, missions, recruits, shopItems }));
    }

    function updateWallet(){ document.getElementById("wallet").textContent = `üí∞ ‚Ç¨${wallet.toLocaleString()}`; saveState(); }

    // Side panels
    function toggleMenu(){ closeShop(); document.getElementById("menuPanel").classList.toggle("open"); renderLists(); }
    function closeShop(){ document.getElementById("shopPanel").classList.remove("open"); }
    function showShop(){ closeMenu(); document.getElementById("shopPanel").classList.add("open"); if(!shopItems.Cars.length) { generateShop("Cars"); generateShop("Houses"); generateShop("Weapons"); } selectTab(shopTab); }
    function closeMenu(){ document.getElementById("menuPanel").classList.remove("open"); }

    // Missions
    function showMission(){
      currentMission = { text: missionTemplates[random(0,missionTemplates.length-1)], details: "Top-secret mission briefing.", payout: random(50000,145000) };
      currentRecruit = currentStock = null;
      renderSections();
    }
    function acceptMission() { missions.push({ ...currentMission }); currentMission = null; renderSections(); renderLists(); saveState(); }
    function completeMission(idx){
      const m = missions.splice(idx,1)[0];
      const isMIA = Math.random() < 0.1 && recruits.length > 0;
      showOverlay(() => {
        if(isMIA){
          const r = recruits.splice(random(0,recruits.length-1),1)[0];
          return `üò¢ ${r.name} has been captured ‚Äî mission failed.`;
        } else {
          wallet += m.payout;
          return `‚úÖ Mission complete! Payout: ‚Ç¨${m.payout.toLocaleString()}`;
        }
      }, () => { updateWallet(); renderLists(); saveState(); });
    }

    function renderLists(){
      document.getElementById("missionsList").innerHTML = missions.length
        ? missions.map((m,i)=>`<div class="card"><strong>${m.text}</strong><br>Payout: ‚Ç¨${m.payout.toLocaleString()}<br><button onclick="completeMission(${i})">Mark Completed</button></div>`).join("")
        : "<p>No active missions.</p>";

      document.getElementById("recruitsList").innerHTML = recruits.length
        ? recruits.map(r=>`<div class="card"><strong>${r.name}</strong><br>${r.skill}, Age ${r.age}<br>${r.location}</div>`).join("")
        : "<p>No recruits.</p>";
    }

    // Recruits
    function showRecruit(){
      currentRecruit = {
        name: stockNames[random(0,stockNames.length-1)]+" Agent",
        age: random(25,45),
        location:["Berlin","Tokyo","NYC","Paris","Cairo","Moscow"][random(0,5)],
        skill:["Assassination","Stealth","Hacking"][random(0,2)],
        cost: random(20000,60000)
      };
      currentMission = currentStock = null;
      renderSections();
    }

    function hireRecruit(){
      if(wallet < currentRecruit.cost) return alert("Insufficient funds.");
      wallet -= currentRecruit.cost;
      recruits.push({ ...currentRecruit });
      showOverlay(`üéâ Hired ${currentRecruit.name} for ‚Ç¨${currentRecruit.cost.toLocaleString()}`, () => {
        updateWallet(); renderLists(); currentRecruit = null; renderSections(); showRecruit(); saveState();
      });
    }

    // Stocks
    function showStocks(){
      currentStock = { name: stockNames[random(0,stockNames.length-1)] };
      currentMission = currentRecruit = null;
      renderSections();
    }

    function investStock(){
      const amt = Number(document.getElementById("stockAmt").value);
      if(!amt || amt < 1 || amt > wallet) return alert("Enter valid amount up to your wallet.");
      const pct = random(78,200), result = Math.round(amt*pct/100);
      wallet += (result - amt);
      showOverlay(() => {
        if(pct > 100) return `üìà Well done! You got ‚Ç¨${result.toLocaleString()} (${pct}%)`;
        if(pct === 100) return "üìä The market didn‚Äôt go anywhere.";
        return `üìâ Oops‚Ä¶ lost ‚Ç¨${(amt - result).toLocaleString()}`;
      }, () => {
        updateWallet(); currentStock = null; renderSections();
      });
    }

    // Shop
    function generateShop(cat){
      const base = cat === "Cars" ? carNames : (cat === "Houses" ? houseNames : weaponNames);
      shopItems[cat] = Array.from({ length: 5 }, (_, i) => {
        return {
          name: base[random(0, base.length-1)] + " " + (i+1),
          cost: cat === "Cars" ? random(100000, 2000000) :
                cat === "Houses" ? random(500000, 5000000) :
                random(10000, 100000)
        };
      });
      clearTimeout(restockTimers[cat]);
      restockTimers[cat] = null;
      saveState();
    }

    function selectTab(tab){
      shopTab = tab;
      document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.id === "tab-" + tab));
      renderShop();
    }

    function renderShop(){
      const content = document.getElementById("shopContent");
      content.innerHTML = ""; // clear
      
      const items = shopItems[shopTab] || [];

      if (!items.length) {
        content.innerHTML = "<p>Seller will restock in two minutes.</p>";
        if (!restockTimers[shopTab]) {
          restockTimers[shopTab] = setTimeout(() => {
            generateShop(shopTab);
            if (shopTab === shopTab) renderShop();
          }, 120000);
        }
      } else {
        content.innerHTML = items.map((it, i) =>
          `<div class="card"><strong>${it.name}</strong><br>Cost: ‚Ç¨${it.cost.toLocaleString()}<br><button onclick="buyItem('${shopTab}',${i})">Buy</button></div>`
        ).join("");
      }
    }

    function buyItem(cat, i){
      const it = shopItems[cat][i];
      if (wallet < it.cost) return alert("Insufficient funds.");
      wallet -= it.cost;
      showOverlay(`üëç Bought ${it.name} for ‚Ç¨${it.cost.toLocaleString()}`, () => {
        updateWallet();
        shopItems[cat].splice(i, 1);
        saveState();
        renderShop();
      });
    }

    // Sections rendering
    function renderSections(){
      document.getElementById("missionBox").innerHTML = currentMission ?
        `<div class="card"><h3>${currentMission.text}</h3><p>${currentMission.details}</p><p><strong>Payout:</strong> ‚Ç¨${currentMission.payout.toLocaleString()}</p><button onclick="acceptMission()">Accept</button></div>` : "";
      document.getElementById("recruitBox").innerHTML = currentRecruit ?
        `<div class="card"><h3>${currentRecruit.name}</h3>Age ${currentRecruit.age}, ${currentRecruit.location}<br>Skill: ${currentRecruit.skill}<br><strong>Cost:</strong> ‚Ç¨${currentRecruit.cost.toLocaleString()}<br><button onclick="hireRecruit()">Hire</button><button onclick="showRecruit()">Next</button></div>` : "";
      document.getElementById("stockBox").innerHTML = currentStock ?
        `<div class="card"><h3>${currentStock.name}</h3><p>Invest amount: ‚Ç¨<input id="stockAmt" type="number"/></p><button onclick="investStock()">Invest</button></div>` : "";
    }

    // Overlay
    function showOverlay(msgOrFn, cb){
      const o = document.getElementById("statusOverlay");
      o.textContent = typeof msgOrFn === "function" ? msgOrFn() : msgOrFn;
      o.style.display = "flex";
      setTimeout(() => {
        o.style.display = "none";
        cb && cb();
      }, 3000);
    }

    // Init
    loadState();
    updateWallet();
    renderLists();
    showMission();
    showRecruit();
  </script>
</body>
</html>